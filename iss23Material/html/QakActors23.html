
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17: http://docutils.sourceforge.net/" />

    <title>QakActors23 &#8212; iss23 1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/classic.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    
    <script src="_static/sidebar.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="QakActors23Demo" href="QakActors23Demo.html" />
    <link rel="prev" title="Appl1ActorsFsm23" href="Appl1ActorsFsm23.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="QakActors23Demo.html" title="QakActors23Demo"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="Appl1ActorsFsm23.html" title="Appl1ActorsFsm23"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">iss23 1.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">QakActors23</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="qakactors23">
<h1>QakActors23<a class="headerlink" href="#qakactors23" title="Permalink to this headline">¶</a></h1>
<p>Il viaggio iniziato enunciando i requisiti dell’<a class="reference internal" href="Applicazione1.html#applicazione1"><span class="std std-ref">Applicazione1</span></a> si è svolto in una sequenza di  tappe
nelle quali abbiamo introdotto nuovi concetti e nuove librerie di supporto:</p>
<ol class="arabic simple">
<li><p>il concetto <a class="reference internal" href="Interaction.html#interaction"><span class="std std-ref">Interaction</span></a> e il relativo supporto: <a class="reference internal" href="unibo.basicomm23.html#unibo-basicomm23"><span class="std std-ref">unibo.basicomm23</span></a></p></li>
<li><p>il concetto di <a class="reference internal" href="Actors23.html#actors23"><span class="std std-ref">attore</span></a> e il relativo supporto: <strong>actors23-1.0.jar</strong> che include</p>
<ul class="simple">
<li><p><a class="reference internal" href="Actors23.html#unibo-basicomm23-actors23-actorbasic23"><span class="std std-ref">unibo.basicomm23.actors23.ActorBasic23</span></a>: classe astratta per attori message-driven.</p></li>
<li><p><a class="reference internal" href="Actors23FSM.html#unibo-actors23-fsm-actorbasicfsm23"><span class="std std-ref">unibo.actors23.fsm.ActorBasicFsm23</span></a> : classe astratta per attori come automi a stati finiti.</p></li>
</ul>
</li>
</ol>
<p>In questa sezione introduciamo un linguaggio custom che introduce notazioni di alto livello per <span class="blue">esprimere</span>
i concetti cui siamo pervenuti nel nostro percorso bottom-up.</p>
<p>Al termine,  potremo disporre delle capacità espressive per catturare alcuni aspetti essenziali nella
organizzazione di sistemi software distribuiti, che abbiamo ormai reccolto nel termine <span class="blue">actor</span>.
Questi concetti costituisocno il <span class="blue">metamodello QActor</span>
e derivano dall’<a class="reference external" href="https://doc.akka.io//docs/akka/current/typed/guide/actors-motivation.html">Akka actor model</a> basato, a sua volta, sul lavoro di <a class="reference external" href="https://en.wikipedia.org/wiki/Carl_Hewitt#Actor_model">Hewitt</a> al MIT .</p>
<section id="qactor23-introduzione">
<h2>QActor23: Introduzione<a class="headerlink" href="#qactor23-introduzione" title="Permalink to this headline">¶</a></h2>
<p>La <span class="blue">Q/q</span>  nella parola <em>QActor</em>, significa “quasi” poiché il linguaggio non è inteso come un linguaggio
di programmazione generico, ma piuttosto un <span class="remark">linguaggio di modellazione eseguibile</span>,
da utilizzzre durante l’analisi del problema e il progetto di protitpi di sistemi distribuiti,
i cui componenti sono  attori  che si comportano come un <a class="reference external" href="https://it.wikipedia.org/wiki/Automa_a_stati_finiti">Automa a stati finiti</a>, in stretta relazione
con l’idea di sistemi basati su <a class="reference external" href="https://microservices.io/">Microservizi</a>.</p>
<p>L’aggiunta di <span class="blue">k</span> al prefisso (es <code class="docutils literal notranslate"><span class="pre">qak</span></code>, <code class="docutils literal notranslate"><span class="pre">Qak</span></code>) significa che stiamo facendo riferimento alla versione
implementata in <a class="reference external" href="https://kotlinlang.org/">Kotlin</a>, senza utilizzare i supporti Akka (come fatto nella prima versione del linguaggio).</p>
<p>Per una <span class="slide2">Introduzione all’uso di Kotlin</span> si veda: <a class="reference external" href="../../../../../it.unibo.kotlinIntro/userDocs/LabIntroductionToKotlin.html">kotlinUnibo</a></p>
<p><span class="slide">Qak overview</span></p>
</section>
<section id="qak-software-factory">
<h2>Qak software factory<a class="headerlink" href="#qak-software-factory" title="Permalink to this headline">¶</a></h2>
<p>Il linguaggio <code class="docutils literal notranslate"><span class="pre">Qak</span></code> è definito utilizzando il framework <a class="reference external" href="https://www.eclipse.org/Xtext/:https://www.eclipse.org/Xtext/">Xtext</a>, che permette di definire un insieme di
<span class="remark">plugin</span> per l’ecosistema Eclipse che, una volta installati, permettono ad un application designer
de definire in tempi rapidi un modello eseguibile del sistema.</p>
<section id="qak-plugin">
<h3>Qak plugin<a class="headerlink" href="#qak-plugin" title="Permalink to this headline">¶</a></h3>
<p>I plugin che,  installati in Eclipse, realizzano la Qak software factory sono:</p>
<ul class="simple">
<li><p>it.unibo.Qactork.ide_1.3.5.jar</p></li>
<li><p>it.unibo.Qactork.ui_1.3.5.jar</p></li>
<li><p>it.unibo.Qactork_1.3.5.jar</p></li>
</ul>
<p>Essi sono disponibili in: <strong>issLab2023/iss23Material/plugins</strong>.</p>
</section>
<section id="qak-codice-e-risorse-generate">
<h3>Qak codice e risorse generate<a class="headerlink" href="#qak-codice-e-risorse-generate" title="Permalink to this headline">¶</a></h3>
<p>La Qak software factory offre:</p>
<ul class="simple">
<li><p>un editor guidato dalla sintassi;</p></li>
<li><p>la generazione di una descrizione del sistema come quella usata
in <a class="reference internal" href="Actors23.html#descrizione-di-un-sistema-distribuito"><span class="std std-ref">Actors23</span></a></p></li>
<li><p>la generazione di un file <em>build.grade</em></p></li>
<li><p>la generazione del codice di raccordo con la <a class="reference internal" href="#qak-infrastructure"><span class="std std-ref">Qak infrastructure</span></a></p></li>
<li><p>la generazione di codice Python per la produzione di una rappresentazione grafica del sistema</p></li>
</ul>
<table class="colwidths-given docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 55%" />
<col style="width: 45%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><img alt="_images/qakSoftwareFactory.png" class="align-center" src="_images/qakSoftwareFactory.png" />
</td>
<td><p>L’application designer usa l’editor guidato dalla sintassi per scrivere un modello del sistema
che definisce <span class="slide2">struttura, interazione e comportamento</span> di un sistema distribuito.</p>
<p>Il modello è una istanza del <span class="blue">metamodello QActor</span>, sulla base del quale è costruita la factory.</p>
<p>Una volta salvato il modello, la factory produce
<a class="reference internal" href="#qak-codice-e-risorse-generate"><span class="std std-ref">codice e risorse</span></a>.</p>
</td>
</tr>
</tbody>
</table>
</section>
<section id="id1">
<h3>Qak syntax<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>La sintassi del linguaggio, che introduce le notazioni relative al <span class="blue">metamodello QActor</span>,
è definita in in <a class="reference external" href="./_static/Qactork.xtext">Qak syntax</a>.  Riportiamo qui alcuni esempi.</p>
<section id="dichiarazione-dei-messaggi">
<h4>Dichiarazione dei messaggi<a class="headerlink" href="#dichiarazione-dei-messaggi" title="Permalink to this headline">¶</a></h4>
<p>I diversi tipi di messaggio sono dichiarati usando una <em>sintassi</em> Prolog-like (si veda <a class="reference external" href="http://amsacta.unibo.it/5450/7/tuprolog-guide.pdf">tuProlog</a> ):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Event</span><span class="p">:</span>    <span class="s2">&quot;Event&quot;</span>     <span class="n">name</span><span class="o">=</span><span class="n">ID</span>  <span class="s2">&quot;:&quot;</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">PHead</span>  <span class="p">;</span>
<span class="n">Dispatch</span><span class="p">:</span> <span class="s2">&quot;Dispatch&quot;</span>  <span class="n">name</span><span class="o">=</span><span class="n">ID</span>  <span class="s2">&quot;:&quot;</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">PHead</span>  <span class="p">;</span>
<span class="n">Request</span><span class="p">:</span>  <span class="s2">&quot;Request&quot;</span>   <span class="n">name</span><span class="o">=</span><span class="n">ID</span>  <span class="s2">&quot;:&quot;</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">PHead</span>  <span class="p">;</span>
<span class="n">Reply</span><span class="p">:</span>    <span class="s2">&quot;Reply&quot;</span>     <span class="n">name</span><span class="o">=</span><span class="n">ID</span>  <span class="s2">&quot;:&quot;</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">PHead</span>  <span class="p">;</span>

<span class="n">PHead</span> <span class="p">:</span>       <span class="n">PAtom</span> <span class="o">|</span> <span class="n">PStruct</span> <span class="o">|</span> <span class="n">PStructRef</span> <span class="p">;</span>
<span class="o">...</span>
</pre></div>
</div>
</section>
<section id="operazioni-di-invio-messaggi">
<h4>Operazioni di invio messaggi<a class="headerlink" href="#operazioni-di-invio-messaggi" title="Permalink to this headline">¶</a></h4>
<p>Le operazioni di invio messaggio sono le seguenti:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Forward</span>   <span class="p">:</span> <span class="s2">&quot;forward&quot;</span> <span class="n">dest</span><span class="o">=</span><span class="p">[</span><span class="n">QActorDeclaration</span><span class="p">]</span>
                      <span class="s2">&quot;-m&quot;</span> <span class="n">msgref</span><span class="o">=</span><span class="p">[</span><span class="n">Dispatch</span><span class="p">]</span> <span class="s2">&quot;:&quot;</span> <span class="n">val</span> <span class="o">=</span> <span class="n">PHead</span> <span class="p">;</span>
<span class="n">Emit</span>      <span class="p">:</span> <span class="s2">&quot;emit&quot;</span> <span class="n">msgref</span><span class="o">=</span><span class="p">[</span><span class="n">Event</span><span class="p">]</span> <span class="s2">&quot;:&quot;</span> <span class="n">val</span> <span class="o">=</span> <span class="n">PHead</span>     <span class="p">;</span>
<span class="n">Demand</span>    <span class="p">:</span> <span class="s2">&quot;request&quot;</span> <span class="n">dest</span><span class="o">=</span><span class="p">[</span><span class="n">QActorDeclaration</span><span class="p">]</span>
                      <span class="s2">&quot;-m&quot;</span> <span class="n">msgref</span><span class="o">=</span><span class="p">[</span><span class="n">Request</span><span class="p">]</span>  <span class="s2">&quot;:&quot;</span> <span class="n">val</span> <span class="o">=</span> <span class="n">PHead</span> <span class="p">;</span>
<span class="n">Answer</span>    <span class="p">:</span> <span class="s2">&quot;replyTo&quot;</span> <span class="n">reqref</span><span class="o">=</span><span class="p">[</span><span class="n">Request</span><span class="p">]</span>
                      <span class="s2">&quot;with&quot;</span>    <span class="n">msgref</span><span class="o">=</span><span class="p">[</span><span class="n">Reply</span><span class="p">]</span>   <span class="s2">&quot;:&quot;</span> <span class="n">val</span> <span class="o">=</span> <span class="n">PHead</span> <span class="p">;</span>
<span class="n">ReplyReq</span>  <span class="p">:</span> <span class="s2">&quot;askFor&quot;</span>  <span class="n">reqref</span><span class="o">=</span><span class="p">[</span><span class="n">Request</span><span class="p">]</span>
                      <span class="s2">&quot;request&quot;</span> <span class="n">msgref</span><span class="o">=</span><span class="p">[</span><span class="n">Request</span><span class="p">]</span> <span class="s2">&quot;:&quot;</span> <span class="n">val</span> <span class="o">=</span> <span class="n">PHead</span> <span class="p">;</span>
</pre></div>
</div>
<p><span class="slide">Usare Qak</span></p>
</section>
</section>
</section>
<section id="startup">
<h2>StartUp<a class="headerlink" href="#startup" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p>Scarica gradle (versione usata qui: <span class="blue">Gradle 7.4.2</span>)</p></li>
<li><p>Scarica <a class="reference external" href="https://www.eclipse.org/Xtext/download.html">Eclipse Xtext</a>   (versione usata qui: <span class="blue">Eclipse  2022-03 (4.23.0)</span>)</p>
<ul class="simple">
<li><p>Java compiler compliance level:  <span class="blue">11</span></p></li>
<li><p>Installed JRE: <span class="blue">jdk 11.08 (default)</span></p></li>
</ul>
</li>
<li><p>Copia nella directory <strong>dropins</strong> di Eclipse i file che costituiscono il supporto al metamodello-qak:</p>
<blockquote>
<div><ul class="simple">
<li><p><span class="blue">it.unibo.Qactork_1.3.5.jar</span></p></li>
<li><p><span class="blue">it.unibo.Qactork.ui_1.3.5.jar</span></p></li>
<li><p><span class="blue">it.unibo.Qactork.ide_1.3.5.jar</span></p></li>
</ul>
</div></blockquote>
</li>
</ol>
<section id="creazione-di-un-nuovo-progetto">
<h3>Creazione di un nuovo progetto<a class="headerlink" href="#creazione-di-un-nuovo-progetto" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p>In <strong>un’area di lavoro vuota</strong>, creare un nuovo progetto Java  utilizzando</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gradle</span> <span class="n">init</span>
   <span class="n">selezionare</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">default</span><span class="p">,</span> <span class="n">default</span>
</pre></div>
</div>
</li>
<li><p>Copiare nell’area di lavoro la directory <span class="blue">unibolibs</span> con le librerie</p></li>
<li><p>Importare il progetto in Eclipse come <strong>Existing Gradle project</strong></p></li>
<li><p>Aggiungere la <strong>natura Java</strong> al progetto</p></li>
<li><p>Aggiungere due <strong>source folder</strong>: di nome <span class="blue">src</span> e di nome  <span class="blue">resources</span></p></li>
<li><p>Creare in <strong>src</strong> un file <span class="blue">qak</span> e aggiungere la <strong>natura Xtext</strong></p>
<p>A questo punto Eclipse dovrebbe presentare una finestra come la seguente:</p>
<a class="reference internal image-reference" href="_images/qakStarting.png"><img alt="_images/qakStarting.png" class="align-center" src="_images/qakStarting.png" style="width: 50%;" /></a>
</li>
<li><p>Scrivere il contenuto del file <strong>qak</strong> e salvare. Tra le <a class="reference internal" href="#qak-codice-e-risorse-generate"><span class="std std-ref">risorse generate</span></a>
vi sono:</p>
<ul class="simple">
<li><p>il file  <span class="blue">build2022.gradle</span></p></li>
<li><p>i files <span class="blue">sysRules.pl</span> e <span class="blue">sysXXX.pl</span> essendo <code class="docutils literal notranslate"><span class="pre">sysXXX</span></code> il nome del <strong>System</strong> nel modello.</p></li>
</ul>
</li>
<li><p>Copiare il contenuto del  file <code class="docutils literal notranslate"><span class="pre">build2022.gradle</span></code> nel file <span class="blue">build.gradle</span>
( o eliminare questo e ridenominare il precedente. Il file <code class="docutils literal notranslate"><span class="pre">build2022.gradle</span></code> verrà rigenerato al prossimo
salvataggio del modello).</p></li>
<li><p>Inserire codice ( Java e/o Kotlin) di utilità usato nel modello entro la directory <span class="blue">resources</span></p></li>
<li><p>Eseguire:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gradlew</span> <span class="n">eclipse</span>
<span class="n">gradlew</span> <span class="n">run</span>
</pre></div>
</div>
</li>
</ol>
</section>
</section>
<section id="qak-model-template">
<h2>Qak model template<a class="headerlink" href="#qak-model-template" title="Permalink to this headline">¶</a></h2>
<p>Le regole sintattche del linguaggio impongono che un
modello Qak venga definito organizzando la sua descrizione nel modo che segue:</p>
<p><span class="slide2">Sequenza delle dichiarazioni nel modello</span></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">System</span> <span class="o">&lt;</span> <span class="n">NAME</span> <span class="n">OF</span> <span class="n">THE</span> <span class="n">SYSTEM</span> <span class="o">&gt;</span>

<span class="o">//</span><span class="n">DECLARATION</span> <span class="n">OF</span> <span class="n">MESSAGES</span> <span class="n">AND</span> <span class="n">EVENTS</span>
<span class="o">...</span>
<span class="o">//</span><span class="n">DECLARATION</span> <span class="n">OF</span> <span class="n">CONTEXTS</span>
<span class="n">Context</span> <span class="n">CTXNAME</span> <span class="n">ip</span> <span class="p">[</span><span class="n">host</span><span class="o">=</span><span class="s2">&quot;HOSTIP&quot;</span> <span class="n">port</span><span class="o">=</span><span class="n">PORTNUM</span><span class="p">]</span>

<span class="o">//</span><span class="n">DECLARATION</span> <span class="n">OF</span> <span class="n">ACTORS</span>
<span class="o">...</span>
</pre></div>
</div>
<p><span class="slide">Qak esempi</span></p>
<p>Esempi di modelli Qak sono disponibili nei seguenti progetti:</p>
<ul class="simple">
<li><p><a class="reference internal" href="Appl1ActorsQak23.html#appl1actorsqak23"><span class="std std-ref">Appl1ActorsQak23</span></a> : <span class="slide2">Nuova versione di Appl1ActorsFsm23</span></p></li>
</ul>
<p>Riportiamo qui solo una considerazione preliminare.</p>
<p><span class="slide1">Da non fare …</span></p>
<p>Il linguaggio Qak mira a esprimere modelli eseguibili, ma
<strong>non è completo dal punto di vista computazionale</strong>.  Dunque, parte del comportamento potrebbe talvolta
dover essere espresso direttamente in Kotlin. Ma occorre non  esagerare con l’uso di una tale possibilità.</p>
<p>Questo esempio definisce un attore che, una volta attivato, calcola il numero di Fibonacci di posizione <code class="docutils literal notranslate"><span class="pre">7</span></code>
usando codice Kotlin.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">System</span> <span class="n">demonottodo</span>
<span class="n">Context</span> <span class="n">ctxdemonottodo</span> <span class="n">ip</span> <span class="p">[</span><span class="n">host</span><span class="o">=</span><span class="s2">&quot;localhost&quot;</span> <span class="n">port</span><span class="o">=</span><span class="mi">8055</span><span class="p">]</span>

<span class="n">QActor</span> <span class="n">demonottodo</span> <span class="n">context</span> <span class="n">ctxdemonottodo</span><span class="p">{</span>
  <span class="n">State</span> <span class="n">s0</span> <span class="n">initial</span> <span class="p">{</span>
  <span class="p">[</span><span class="c1">#</span>
    <span class="n">fun</span> <span class="n">fibo</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="n">Int</span><span class="p">)</span> <span class="p">:</span> <span class="n">Int</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="n">throw</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;fibo argument must be &gt;0&quot;</span><span class="p">)</span>
      <span class="k">if</span><span class="p">(</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">n</span><span class="o">==</span><span class="mi">1</span> <span class="p">)</span> <span class="k">return</span> <span class="n">n</span>
      <span class="k">return</span> <span class="n">fibo</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">fibo</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">println</span><span class="p">(</span><span class="s2">&quot;---------------------------------------------------- &quot;</span><span class="p">)</span>
    <span class="n">println</span><span class="p">(</span><span class="s2">&quot;This actor definies its activity completelyin Kotlin&quot;</span><span class="p">)</span>
    <span class="n">val</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">7</span>
    <span class="n">val</span> <span class="n">v</span> <span class="o">=</span> <span class="n">fibo</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">println</span><span class="p">(</span><span class="s2">&quot;fibo($n)=$v&quot;</span><span class="p">)</span>
    <span class="n">println</span><span class="p">(</span><span class="s2">&quot;----------------------------------------------------- &quot;</span><span class="p">)</span>
  <span class="c1">#]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Quando questo file viene salvato, la <a class="reference internal" href="#qak-software-factory"><span class="std std-ref">Qak software factory</span></a> genera il file <code class="docutils literal notranslate"><span class="pre">demonottodo.pl</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">context</span><span class="p">(</span><span class="n">ctxdemonottodo</span><span class="p">,</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span>  <span class="s2">&quot;TCP&quot;</span><span class="p">,</span> <span class="s2">&quot;8055&quot;</span><span class="p">)</span><span class="o">.</span>
<span class="n">qactor</span><span class="p">(</span> <span class="n">demonottodo</span><span class="p">,</span> <span class="n">ctxdemonottodo</span><span class="p">,</span> <span class="s2">&quot;it.unibo.demonottodo.Demonottodo&quot;</span><span class="p">)</span><span class="o">.</span>
</pre></div>
</div>
<p><span class="slide1">… meglio così</span></p>
<p>Per limitare l’uso diretto di codice Kotlin, è opportuno introdurre classi di utilità e invocarne i metodi.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">System</span> <span class="n">demobetter</span>
<span class="n">Context</span> <span class="n">ctxdemobetter</span> <span class="n">ip</span> <span class="p">[</span><span class="n">host</span><span class="o">=</span><span class="s2">&quot;localhost&quot;</span> <span class="n">port</span><span class="o">=</span><span class="mi">8055</span><span class="p">]</span>

<span class="n">QActor</span> <span class="n">demobetter</span> <span class="n">context</span> <span class="n">ctxdemobetter</span><span class="p">{</span>
  <span class="p">[</span><span class="c1"># var n = 7  #] //Global variable</span>
  <span class="n">State</span> <span class="n">s0</span> <span class="n">initial</span> <span class="p">{</span>
    <span class="p">[</span><span class="c1">#  ut.outMsg( &quot;fibo($n)=&quot; + ut.fibo(n))    #]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>La utility <strong>ut</strong> potrebbe essere codice scritto in Java o in Kotlin e inserito
nella directory <span class="blue">resources</span> (si veda <a class="reference internal" href="#creazione-di-un-nuovo-progetto"><span class="std std-ref">Creazione di un nuovo progetto</span></a>) . Ad esempio:</p>
<div class="highlight-kotlin notranslate"><div class="highlight"><pre><span></span><span class="kd">object</span> <span class="nc">ut</span> <span class="p">{</span>
  <span class="kd">fun</span> <span class="nf">fibo</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="p">:</span> <span class="kt">Int</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="m">0</span> <span class="p">)</span> <span class="k">throw</span> <span class="n">Exception</span><span class="p">(</span><span class="s">&quot;fibo argument must be &gt;0&quot;</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">n</span> <span class="o">==</span> <span class="m">0</span> <span class="o">||</span> <span class="n">n</span><span class="o">==</span><span class="m">1</span> <span class="p">)</span> <span class="k">return</span> <span class="n">n</span>
    <span class="kd">var</span> <span class="nv">v</span> <span class="o">=</span> <span class="n">fibo</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="m">1</span><span class="p">)</span><span class="o">+</span><span class="n">fibo</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="m">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">v</span>
  <span class="p">}</span>
  <span class="kd">fun</span> <span class="nf">outMsg</span><span class="p">(</span> <span class="n">m</span><span class="p">:</span> <span class="kt">String</span> <span class="p">){</span>
    <span class="n">ColorsOut</span><span class="p">.</span><span class="na">outappl</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">ColorsOut</span><span class="p">.</span><span class="na">GREEN</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><span class="worktodo">TODO</span>: scrivere il sistema produttori-consumatore in Qak</p>
</section>
<section id="qak-infrastructure">
<h2>Qak infrastructure<a class="headerlink" href="#qak-infrastructure" title="Permalink to this headline">¶</a></h2>
<p>La libreria <strong>unibo.qakactor23-3.5*.jar</strong> fornisce la <span class="blue">qak-infrastructure</span> e si appoggia
al supporto <strong>unibo.basicomm23-1.0.jar</strong> introdotto nel progetto <a class="reference internal" href="unibo.basicomm23.html#unibo-basicomm23"><span class="std std-ref">unibo.basicomm23</span></a>,
che implementa il concetto <a class="reference internal" href="Interaction.html#interaction"><span class="std std-ref">Interaction</span></a> per diversi protocolli (TCP, UDP, CoAP, …).</p>
<section id="variabili">
<h3>Variabili<a class="headerlink" href="#variabili" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>myself</p></li>
<li><p>currentMsg</p></li>
<li><p>curState</p></li>
</ul>
</section>
<section id="esecuzione">
<h3>Esecuzione<a class="headerlink" href="#esecuzione" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>qrun : <code class="docutils literal notranslate"><span class="pre">qrun</span> <span class="pre">ccc.xxx()</span></code>  invoca  il metodo <em>static</em>  <code class="docutils literal notranslate"><span class="pre">xxx</span></code> della classe <code class="docutils literal notranslate"><span class="pre">ccc</span></code>. Il
metodo deve avere come primo argomento un riferimento all’attore corrente (ad esempio <strong>myself</strong>).</p></li>
<li><p>run: <code class="docutils literal notranslate"><span class="pre">run</span> <span class="pre">ccc.xxx()</span></code>  invoca  il metodo <em>static</em> <code class="docutils literal notranslate"><span class="pre">xxx</span></code> della classe <code class="docutils literal notranslate"><span class="pre">ccc</span></code>.</p></li>
</ul>
<p><span class="slide">Attori particolari</span></p>
</section>
</section>
<section id="externalqactor">
<h2>ExternalQActor<a class="headerlink" href="#externalqactor" title="Permalink to this headline">¶</a></h2>
<p>Un sistema software ad attori Qak può essere pensato come un organismo che comincia ad
operare solo quando tutte le sue parti sono state costruite ed attivate.</p>
<p>In molti casi però, come di solito accade nelle architetture a <a class="reference external" href="https://microservices.io/">Microservizi</a>,
un sistema si configura e si costruisce ‘incrementalmente’, partendo da un <span class="blue">servizio iniziale</span>
e poi aggiungendo ulteriori servizi, che interagiscono con quello iniziale e tra loro sempre
solo mediante scambio di messaggi.</p>
<p>Per un esempio introduttivo si veda: <strong>Progetto</strong>: <em>it.unibo.resourcecore</em></p>
</section>
<section id="streamedqactor">
<h2>StreamedQActor<a class="headerlink" href="#streamedqactor" title="Permalink to this headline">¶</a></h2>
<p>La <a class="reference external" href="https://en.wikipedia.org/wiki/Reactive_programming">Reactive programming</a> è una combinazione di idee riconducibili al modello <em>Observer</em>,
al modello <em>Iterator</em> e alla <em>programmazione funzionale</em>.
In questo stile di programmazione, un servizio-consumatore reagisce ai dati non appena arrivano, con la capacità
anche di <em>propagare le modifiche come eventi</em> agli osservatori registrati.</p>
<p>Un QAkActor può lavorare come un <em>produttore osservabile di dati</em>, cioè può
inivare messaggi ad altri attori locali allo stesso contesto,
che si sono (o vengono) ‘resistrati come osservatori’ presso di lui, con la primitiva <span class="blue">subscribeTo</span>.</p>
<p>Ciascun attore-sottoscrittore elabora i dati ‘in parallelo’ con gli altri e può a sua volta funzionare come osservabile.</p>
<p>Per un esempio introduttivo si veda:</p>
</section>
<section id="codedqactor">
<h2>CodedQActor<a class="headerlink" href="#codedqactor" title="Permalink to this headline">¶</a></h2>
<p>Vi sono situazioni in cui è preferibile introdurre attori scritti direttamente in Kotlin (o in Java)
ed utlizzarli come una sorta di componenti predefiniti in modelli descritti in linguaggio QAk.</p>
<ul>
<li><p>A CodedQActor is an actor completely written in Kotlin that can be included in a QAk-model by specifying its class name.</p></li>
<li><p>A CodedQActor is usually defined as a specilization of ActorBasic:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">qacoded</span> <span class="p">(</span><span class="n">name</span> <span class="p">:</span> <span class="n">String</span> <span class="p">)</span> <span class="p">:</span> <span class="n">ActorBasic</span><span class="p">(</span> <span class="n">name</span> <span class="p">)</span> <span class="p">{</span>
  <span class="n">override</span> <span class="n">suspend</span> <span class="n">fun</span> <span class="n">actorBody</span><span class="p">(</span><span class="n">msg</span><span class="p">:</span> <span class="n">ApplMessage</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">//...</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>The <a class="reference internal" href="#qak-infrastructure"><span class="std std-ref">Qak infrastructure</span></a> handles a CodedQActor as a usual; in particular,
it ‘injects’ into the CodedQActor the context specified by the model.</p></li>
</ul>
<p>Per un esempio introduttivo si veda:</p>
</section>
<section id="attore-come-risorsa-coap">
<h2>Attore come risorsa CoAP<a class="headerlink" href="#attore-come-risorsa-coap" title="Permalink to this headline">¶</a></h2>
<p>In progress …</p>
<p><span class="slide">Operazioni disponibili</span></p>
</section>
<section id="qak-primitive-disponibili">
<h2>Qak primitive disponibili<a class="headerlink" href="#qak-primitive-disponibili" title="Permalink to this headline">¶</a></h2>
<p>In progress ..</p>
<section id="emissione-di-eventi">
<h3>Emissione di eventi<a class="headerlink" href="#emissione-di-eventi" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>emit</p></li>
<li><p>emitLocal</p></li>
<li><p>emitLocalStream</p></li>
</ul>
</section>
<section id="invio-di-messaggi">
<h3>Invio di messaggi<a class="headerlink" href="#invio-di-messaggi" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>forward</p></li>
<li><p>request</p></li>
<li><p>reply</p></li>
<li><p>askFor</p></li>
</ul>
</section>
<section id="utilita">
<h3>Utilità<a class="headerlink" href="#utilita" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>printCurrentMessage</p></li>
<li><p>println</p></li>
<li><p>solve</p></li>
<li><p>discardMsg</p></li>
<li><p>memoCurrentTime</p></li>
<li><p>setDuration</p></li>
<li><p>updateResource</p></li>
<li><p>observeResource</p></li>
<li><p>subscribeTo</p></li>
<li><p>delegate</p></li>
<li><p>payload</p></li>
</ul>
</section>
<section id="whentime">
<h3>whentime<a class="headerlink" href="#whentime" title="Permalink to this headline">¶</a></h3>
</section>
<section id="interrupt">
<h3>interrupt<a class="headerlink" href="#interrupt" title="Permalink to this headline">¶</a></h3>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">QakActors23</a><ul>
<li><a class="reference internal" href="#qactor23-introduzione">QActor23: Introduzione</a></li>
<li><a class="reference internal" href="#qak-software-factory">Qak software factory</a><ul>
<li><a class="reference internal" href="#qak-plugin">Qak plugin</a></li>
<li><a class="reference internal" href="#qak-codice-e-risorse-generate">Qak codice e risorse generate</a></li>
<li><a class="reference internal" href="#id1">Qak syntax</a><ul>
<li><a class="reference internal" href="#dichiarazione-dei-messaggi">Dichiarazione dei messaggi</a></li>
<li><a class="reference internal" href="#operazioni-di-invio-messaggi">Operazioni di invio messaggi</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#startup">StartUp</a><ul>
<li><a class="reference internal" href="#creazione-di-un-nuovo-progetto">Creazione di un nuovo progetto</a></li>
</ul>
</li>
<li><a class="reference internal" href="#qak-model-template">Qak model template</a></li>
<li><a class="reference internal" href="#qak-infrastructure">Qak infrastructure</a><ul>
<li><a class="reference internal" href="#variabili">Variabili</a></li>
<li><a class="reference internal" href="#esecuzione">Esecuzione</a></li>
</ul>
</li>
<li><a class="reference internal" href="#externalqactor">ExternalQActor</a></li>
<li><a class="reference internal" href="#streamedqactor">StreamedQActor</a></li>
<li><a class="reference internal" href="#codedqactor">CodedQActor</a></li>
<li><a class="reference internal" href="#attore-come-risorsa-coap">Attore come risorsa CoAP</a></li>
<li><a class="reference internal" href="#qak-primitive-disponibili">Qak primitive disponibili</a><ul>
<li><a class="reference internal" href="#emissione-di-eventi">Emissione di eventi</a></li>
<li><a class="reference internal" href="#invio-di-messaggi">Invio di messaggi</a></li>
<li><a class="reference internal" href="#utilita">Utilità</a></li>
<li><a class="reference internal" href="#whentime">whentime</a></li>
<li><a class="reference internal" href="#interrupt">interrupt</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="Appl1ActorsFsm23.html"
                          title="previous chapter">Appl1ActorsFsm23</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="QakActors23Demo.html"
                          title="next chapter">QakActors23Demo</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/QakActors23.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="QakActors23Demo.html" title="QakActors23Demo"
             >next</a> |</li>
        <li class="right" >
          <a href="Appl1ActorsFsm23.html" title="Appl1ActorsFsm23"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">iss23 1.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">QakActors23</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2022, Antonio Natali.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.4.0.
    </div>
  </body>
</html>