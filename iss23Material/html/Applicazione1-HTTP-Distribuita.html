
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17: http://docutils.sourceforge.net/" />

    <title>Applicazione1-HTTP-Distribuita &#8212; iss23 1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/classic.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    
    <script src="_static/sidebar.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="index.html">iss23 1.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Applicazione1-HTTP-Distribuita</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="applicazione1-http-distribuita">
<h1>Applicazione1-HTTP-Distribuita<a class="headerlink" href="#applicazione1-http-distribuita" title="Permalink to this headline">¶</a></h1>
<p>In questa nuova fase dello sviluppo, dobbiamo superare le limitazioni che ci siamo imposti per
<a class="reference internal" href="Applicazione1-HTTP-Core.html#applicazione1-http-core"><span class="std std-ref">Applicazione1-HTTP-Core</span></a>, tenendo conto di quanto già osservato in
<a class="reference internal" href="Applicazione1.html#appl1-natura-dei-componenti"><span class="std std-ref">Appl1: Natura dei componenti</span></a> della <a class="reference internal" href="Applicazione1.html#appl1-architettura-logica"><span class="std std-ref">Appl1: Architettura logica</span></a>.</p>
<p>Utente –&gt; <span class="remark">CmdConsole –&gt; Appl1</span>–&gt; <a class="reference internal" href="VirtualRobot23.html#virtualrobot23"><span class="std std-ref">VirtualRobot23</span></a></p>
<p>In particolare detto <code class="docutils literal notranslate"><span class="pre">P</span></code> uno dei protocolli definiti in <a class="reference internal" href="Applicazione1-HTTP-Core.html#unibo-basicomm23-msg-protocoltype"><span class="std std-ref">ProtocolType</span></a>:</p>
<ol class="arabic simple">
<li><p>L’applicazione <em>Appl1</em> deve diventare un ente attivo capace  di ricevere messaggi (comandi <code class="docutils literal notranslate"><span class="pre">start/stop/resume</span></code>)
via <code class="docutils literal notranslate"><span class="pre">P</span></code> e   <span class="blue">interpretare</span> tali messaggi,  convertendoli in comandi a <a class="reference internal" href="VirtualRobot23.html#virtualrobot23"><span class="std std-ref">VirtualRobot23</span></a>.</p></li>
<li><p><em>CmdConsole</em> deve diventare un ente attivo che interagisce con un utente umano e che invia comandi ad <code class="docutils literal notranslate"><span class="pre">Appl1</span></code>
usando il protocollo <code class="docutils literal notranslate"><span class="pre">P</span></code>.</p></li>
</ol>
<p>La fase di interpretazione dei comandi è affidata a <em>Appl1</em> in quanto:</p>
<ul class="simple">
<li><p>la <em>CmdConsole</em> è solo un dispositivo di input, che si vuole mantenere libero da aspetti legati alla business logic;</p></li>
<li><p><em>Appl1</em> potrebbe ricevere comandi da dispositivi diversi dalla <em>CmdConsole</em>.</p></li>
</ul>
<p>Nell’impostare il lavoro abbiamo ora un punto di partenza
costituito dal codice di <a class="reference internal" href="Applicazione1-HTTP-Core.html#unibo-appl1-http-application1httpcore"><span class="std std-ref">unibo.appl1.http.Application1HTTPCore</span></a>, che realizza la logica di business.</p>
<p>Il nostro obiettivo qui, è <span class="blue">riusare</span> il più possibile questo codice (già testato), seguendo il
principio  della <strong>Clean Architecture</strong>: le nuove funzionalità
di comunicazione vanno introdotte senza modificare il nucleo centrale dell’applicazione.</p>
<p>Il progetto <a class="reference internal" href="unibo.basicomm23.html#unibo-basicomm23"><span class="std std-ref">unibo.basicomm23</span></a> aiuta a raggiungere questo obiettivo.</p>
<p>Cominciamo con il rivedere le interazioni  <span class="remark">Appl –&gt;  VirtualRobot23</span></p>
<section id="refactoring-di-vrobothlmoveshttpapache">
<h2>Refactoring di VrobotHLMovesHTTPApache<a class="headerlink" href="#refactoring-di-vrobothlmoveshttpapache" title="Permalink to this headline">¶</a></h2>
<p>La classe <a class="reference internal" href="Applicazione1-HTTP-Core.html#unibo-supports-vrobothlmoveshttpapache"><span class="std std-ref">unibo.supports.VrobotHLMovesHTTPApache</span></a>
che definisce le mosse di alto livello del robot può essere ridefinita in modo da utilizzare
un supporto che implementa <span class="xref std std-ref">Interaction2021</span>
usando il protocollo <code class="docutils literal notranslate"><span class="pre">HTTP</span></code>.</p>
<section id="unibo-supports-vrobothlmoveshttp">
<h3>unibo.supports.VrobotHLMovesHTTP<a class="headerlink" href="#unibo-supports-vrobothlmoveshttp" title="Permalink to this headline">¶</a></h3>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">VrobotHLMovesHTTPApache</span> <span class="kd">implements</span> <span class="n">IVrobotMoves</span><span class="p">{</span>
<span class="kd">private</span> <span class="n">Interaction2021</span> <span class="n">httpSupport</span>  <span class="p">;</span>
<span class="kd">public</span> <span class="nf">VrobotHLMovesHTTP</span><span class="p">(</span><span class="n">Interaction2021</span> <span class="n">httpSupport</span><span class="p">){</span><span class="k">this</span><span class="p">.</span><span class="na">httpSupport</span> <span class="o">=</span> <span class="n">httpSupport</span><span class="p">;}</span>
<span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">turnLeft</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">Exception</span><span class="p">{</span> <span class="n">httpSupport</span><span class="p">.</span><span class="na">request</span><span class="p">(</span><span class="n">VrobotMsgs</span><span class="p">.</span><span class="na">turnleftcmd</span><span class="p">);}</span>
<span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">turnRight</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">Exception</span><span class="p">{</span><span class="n">httpSupport</span><span class="p">.</span><span class="na">request</span><span class="p">(</span><span class="n">VrobotMsgs</span><span class="p">.</span><span class="na">turnrightcmd</span><span class="p">);}</span>
<span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">forward</span><span class="p">(</span><span class="kt">int</span> <span class="n">time</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span><span class="p">{</span>
    <span class="n">String</span> <span class="n">result</span> <span class="o">=</span> <span class="n">httpSupport</span><span class="p">.</span><span class="na">request</span><span class="p">(</span>  <span class="n">VrobotMsgs</span><span class="p">.</span><span class="na">forwardcmd</span><span class="p">.</span><span class="na">replace</span><span class="p">(</span><span class="s">&quot;TIME&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="o">+</span><span class="n">time</span><span class="p">)</span>  <span class="p">);</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">result</span><span class="p">.</span><span class="na">contains</span><span class="p">(</span><span class="s">&quot;collision&quot;</span><span class="p">)</span>  <span class="p">){</span> <span class="k">throw</span> <span class="k">new</span> <span class="n">CollisionException</span><span class="p">(</span>  <span class="p">)</span> <span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
<span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">backward</span><span class="p">(</span><span class="kt">int</span> <span class="n">time</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span><span class="p">{</span>
    <span class="n">String</span> <span class="n">result</span> <span class="o">=</span> <span class="n">httpSupport</span><span class="p">.</span><span class="na">request</span><span class="p">(</span>  <span class="n">VrobotMsgs</span><span class="p">.</span><span class="na">backwardcmd</span><span class="p">.</span><span class="na">replace</span><span class="p">(</span><span class="s">&quot;TIME&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="o">+</span><span class="n">time</span><span class="p">)</span>  <span class="p">);</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">result</span><span class="p">.</span><span class="na">contains</span><span class="p">(</span><span class="s">&quot;collision&quot;</span><span class="p">)</span>  <span class="p">){</span> <span class="k">throw</span> <span class="k">new</span> <span class="n">CollisionException</span><span class="p">(</span>  <span class="p">)</span> <span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
<span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">halt</span><span class="p">(</span> <span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span> <span class="n">httpSupport</span><span class="p">.</span><span class="na">request</span><span class="p">(</span>  <span class="n">VrobotMsgs</span><span class="p">.</span><span class="na">haltcmd</span>  <span class="p">);</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="unibo-appl1-interaction-vrobothlmoves">
<h3>unibo.appl1.interaction.VrobotHLMoves<a class="headerlink" href="#unibo-appl1-interaction-vrobothlmoves" title="Permalink to this headline">¶</a></h3>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">unibo.appl1.interaction</span><span class="p">;</span>

 <span class="kd">public</span> <span class="kd">class</span> <span class="nc">VrobotHLMoves</span> <span class="kd">implements</span> <span class="n">IVrobotMoves</span><span class="p">{</span>
 <span class="kd">private</span> <span class="n">Interaction2021</span> <span class="n">conn</span>  <span class="p">;</span>

 <span class="kd">public</span> <span class="nf">VrobotHLMoves</span><span class="p">(</span><span class="n">Interaction2021</span> <span class="n">conn</span><span class="p">)</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="na">conn</span> <span class="o">=</span> <span class="n">conn</span><span class="p">;}</span>
</pre></div>
</div>
<p>Le chiamate a <code class="docutils literal notranslate"><span class="pre">WEnv</span></code> vengono realizzate sostituendo frasi quali <code class="docutils literal notranslate"><span class="pre">httpSupport.requestSynch(VrobotMsgs.xxx);</span></code>
con:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">conn</span><span class="p">.</span><span class="na">request</span><span class="p">(</span><span class="n">VrobotMsgs</span><span class="p">.</span><span class="na">xxx</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="unibo-appl1-common-vrobotmsgs">
<h3>unibo.appl1.common.VrobotMsgs<a class="headerlink" href="#unibo-appl1-common-vrobotmsgs" title="Permalink to this headline">¶</a></h3>
<p>La classe <em>VrobotMsgs</em> definisce alcuni <a class="reference internal" href="Interaction2021.html#natura-e-struttura-dei-messaggi-applicativi"><span class="std std-ref">messaggi applicativi</span></a>
per il robot.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">turnrightcmd</span>  <span class="o">=</span>
    <span class="s">&quot;{\&quot;robotmove\&quot;:\&quot;turnRight\&quot;   , \&quot;time\&quot;: \&quot;300\&quot;}&quot;</span><span class="p">;</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">turnleftcmd</span>  <span class="o">=</span>
    <span class="s">&quot;{\&quot;robotmove\&quot;:\&quot;turnLeft\&quot;     , \&quot;time\&quot;: \&quot;500\&quot;}&quot;</span><span class="p">;</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">forwardcmd</span>   <span class="o">=</span>
    <span class="s">&quot;{\&quot;robotmove\&quot;:\&quot;moveForward\&quot;  , \&quot;time\&quot;: TIME}&quot;</span><span class="p">;</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">backwardcmd</span>  <span class="o">=</span>
    <span class="s">&quot;{\&quot;robotmove\&quot;:\&quot;moveBackward\&quot; , \&quot;time\&quot;: TIME}&quot;</span><span class="p">;</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">haltcmd</span>      <span class="o">=</span>
    <span class="s">&quot;{\&quot;robotmove\&quot;:\&quot;alarm\&quot; ,        \&quot;time\&quot;: \&quot;10\&quot;}&quot;</span><span class="p">;</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">stepcmd</span>      <span class="o">=</span>
    <span class="s">&quot;{\&quot;robotmove\&quot;:\&quot;moveForward\&quot;  , \&quot;time\&quot;: \&quot;350\&quot;}&quot;</span><span class="p">;</span>
<span class="p">...</span>
</pre></div>
</div>
<p>Il supporto richiesto per le comunicazioni con <a class="reference internal" href="VirtualRobot23.html#virtualrobot23"><span class="std std-ref">VirtualRobot23</span></a> viene ottenuto da
una chiamata a <a class="reference internal" href="unibo.basicomm23.html#unibo-basicomm23-utils-connectionfactory"><span class="std std-ref">unibo.basicomm23.utils.ConnectionFactory</span></a> da parte del main applicativo.</p>
</section>
</section>
<section id="supporti-hl-robot">
<h2>Supporti HL-robot<a class="headerlink" href="#supporti-hl-robot" title="Permalink to this headline">¶</a></h2>
<p>La classe  <a class="reference internal" href="#unibo-supports-vrobothlmoveshttp"><span class="std std-ref">VrobotHLMovesHTTP</span></a> fornisce mosse di alto livelo del robot
usando  <a class="reference internal" href="Interaction2021-HTTP-WS.html#httpconnection"><span class="std std-ref">HttpConnection</span></a> per le interazioni con WEnv.</p>
<p>In prospettiva, svilupperemo di certo anche una classe  <a class="reference internal" href="Applicazione1-WS.html#unibo-supports-vrobothlmovesws"><span class="std std-ref">VrobotHLMovesWS</span></a>
come supporto per mosse di alto livelo del robot
usando  <a class="reference internal" href="Interaction2021-HTTP-WS.html#wsconnection"><span class="std std-ref">WsConnection</span></a> per le interazioni con WEnv.</p>
<p>E’ quindi opportuno introdurre anche una factory per costruire l’opportuno oggetto di supporto alla comunicazione
con il robot che implementa l’intefaccia <a class="reference internal" href="Applicazione1-HTTP-Core.html#unibo-common-ivrobotmoves"><span class="std std-ref">IVrobotMoves</span></a>
usando <code class="docutils literal notranslate"><span class="pre">HTTP</span></code> o <code class="docutils literal notranslate"><span class="pre">WS</span></code>.</p>
<section id="unibo-supports-vrobothlsupportfactory">
<h3>unibo.supports.VrobotHLSupportFactory<a class="headerlink" href="#unibo-supports-vrobothlsupportfactory" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><a class="reference internal" href="Applicazione1-HTTP-Core.html#unibo-common-ivrobotmoves"><span class="std std-ref">IVrobotMoves</span></a></p></li>
<li><p><a class="reference internal" href="Interaction2021-HTTP-WS.html#httpconnection"><span class="std std-ref">HttpConnection</span></a></p></li>
<li><p><a class="reference internal" href="Interaction2021-HTTP-WS.html#wsconnection"><span class="std std-ref">WsConnection</span></a></p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">VrobotHLSupportFactory</span> <span class="p">{</span>
 <span class="kd">public</span> <span class="kd">static</span> <span class="n">IVrobotMoves</span> <span class="nf">create</span><span class="p">(</span><span class="n">String</span> <span class="n">hostIp</span><span class="p">,</span> <span class="n">ProtocolType</span> <span class="n">protocol</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span> <span class="n">protocol</span> <span class="o">==</span> <span class="n">ProtocolType</span><span class="p">.</span><span class="na">http</span> <span class="p">)</span> <span class="k">return</span> <span class="n">supportForHTTP</span><span class="p">(</span><span class="n">hostIp</span><span class="p">);</span>
     <span class="k">else</span> <span class="k">if</span><span class="p">(</span> <span class="n">protocol</span> <span class="o">==</span> <span class="n">ProtocolType</span><span class="p">.</span><span class="na">ws</span> <span class="p">)</span> <span class="k">return</span> <span class="n">supportForWS</span><span class="p">(</span><span class="n">hostIp</span><span class="p">);</span>
     <span class="k">else</span> <span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span><span class="p">(</span><span class="s">&quot;VrobotHLSupportFactory protocol not allowed&quot;</span><span class="p">);</span>
 <span class="p">}</span>
 <span class="kd">public</span> <span class="kd">static</span> <span class="n">IVrobotMoves</span> <span class="nf">supportForHTTP</span><span class="p">(</span><span class="n">String</span> <span class="n">hostIp</span><span class="p">){</span>
     <span class="n">Interaction2021</span> <span class="n">connToWEnv</span> <span class="o">=</span> <span class="n">HttpConnection</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">hostIp</span><span class="o">+</span><span class="s">&quot;:8090/api/move&quot;</span><span class="p">);</span>
     <span class="k">return</span> <span class="k">new</span> <span class="n">VrobotHLMovesHTTP</span><span class="p">(</span> <span class="n">connToWEnv</span>  <span class="p">);</span>
 <span class="p">}</span>
 <span class="kd">public</span> <span class="kd">static</span> <span class="n">IVrobotMoves</span> <span class="nf">supportForWS</span><span class="p">(</span><span class="n">String</span> <span class="n">hostIp</span><span class="p">){</span>
     <span class="n">Interaction2021</span> <span class="n">connToWEnv</span> <span class="o">=</span> <span class="n">WsConnection</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">hostIp</span><span class="o">+</span><span class="s">&quot;:8091&quot;</span><span class="p">);</span>
     <span class="k">return</span> <span class="k">new</span> <span class="n">VrobotHLMovesWS</span><span class="p">(</span> <span class="n">connToWEnv</span>  <span class="p">);</span>
 <span class="p">}</span>
 <span class="kd">public</span> <span class="kd">static</span> <span class="n">IVrobotMoves</span> <span class="nf">supportForWSPlanned</span><span class="p">(</span><span class="n">String</span> <span class="n">hostIp</span><span class="p">,</span> <span class="n">IObserver</span> <span class="n">obs</span><span class="p">,</span> <span class="kt">boolean</span> <span class="n">fastPc</span><span class="p">){</span>
     <span class="n">Interaction2021</span> <span class="n">connToWEnv</span> <span class="o">=</span> <span class="n">WsConnection</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">hostIp</span><span class="o">+</span><span class="s">&quot;:8091&quot;</span><span class="p">);</span>
     <span class="n">Planner23Util</span> <span class="n">planner</span>          <span class="o">=</span> <span class="k">new</span> <span class="n">Planner23Util</span><span class="p">();</span>
     <span class="k">return</span> <span class="k">new</span> <span class="n">VrobotHLMovesWSPlanned</span><span class="p">((</span><span class="n">WsConnection</span><span class="p">)</span> <span class="n">connToWEnv</span><span class="p">,</span> <span class="n">planner</span><span class="p">,</span> <span class="n">obs</span><span class="p">,</span> <span class="n">fastPc</span> <span class="p">);</span>
 <span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="il-contratto-applicativo">
<h2>Il contratto applicativo<a class="headerlink" href="#il-contratto-applicativo" title="Permalink to this headline">¶</a></h2>
<p>L’applicazione può essere vista come un componente che realizza l’insieme di operazione definite dalla
seguente interfaccia.</p>
<section id="iapplication1">
<h3>IApplication1<a class="headerlink" href="#iapplication1" title="Permalink to this headline">¶</a></h3>
<p>L’applicazione viene concepita come un POJO <strong>oserervabile</strong> (per la motivazione si veda
<a class="reference internal" href="Applicazione1-HTTP-Core.html#application1httpcore-observable"><span class="std std-ref">Application1HTTPCore observable</span></a>) che offre operazioni per l’aggiunta di observer:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">IApplication1</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">start</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">Exception</span><span class="p">;</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">stop</span><span class="p">();</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">resume</span><span class="p">();</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addAnObserverOnAppl</span><span class="p">(</span><span class="n">IObserver</span> <span class="n">o</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p><a class="reference internal" href="Applicazione1-HTTP-Core.html#metodi-start-stop-resume"><span class="std std-ref">start</span></a>: che attiva l’applicazione (nel Thread corrente);</p></li>
<li><p><a class="reference internal" href="Applicazione1-HTTP-Core.html#metodi-start-stop-resume"><span class="std std-ref">stop</span></a>: che ferma l’applicazione, se questa esegue <a class="reference internal" href="Applicazione1-HTTP-Core.html#walkbysteppingwithstop"><span class="std std-ref">walkBySteppingWithStop</span></a>;</p></li>
<li><p><a class="reference internal" href="Applicazione1-HTTP-Core.html#metodi-start-stop-resume"><span class="std std-ref">resume</span></a>: che riattiva l’applicazione.</p></li>
</ul>
<p>Il codice che esprime la business logic è quello già introdotto in <a class="reference internal" href="Applicazione1-HTTP-Core.html#codice-di-unibo-appl1-http-application1httpcore"><span class="std std-ref">codice di unibo.appl1.http.Application1HTTPCore</span></a>.</p>
<p>Tuttavia, per agevolare lo sviluppo di diverse versioni dell’applicazione, introduciamo la classe astratta
<a class="reference internal" href="#unibo-appl1-common-application1abstractbase"><span class="std std-ref">unibo.appl1.common.Application1AbstractBase</span></a> che
realizza le funzionalità <code class="docutils literal notranslate"><span class="pre">stert/stop/resume</span></code> di <a class="reference internal" href="#iapplication1"><span class="std std-ref">IApplication1</span></a>, lasciando a classi specializzate il compito di definire
il metodo che stabilisce il comportamento della specifica applicazione:</p>
<ul class="simple">
<li><p><span class="blue">abstract void doJob()</span> throws Exception</p></li>
</ul>
</section>
<section id="unibo-appl1-common-application1abstractbase">
<h3>unibo.appl1.common.Application1AbstractBase<a class="headerlink" href="#unibo-appl1-common-application1abstractbase" title="Permalink to this headline">¶</a></h3>
<p><em>Application1AbstractBase</em> implementa <a class="reference internal" href="#iapplication1"><span class="std std-ref">IApplication1</span></a> e definisce le operazioni che permettono stop e resume.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Application1AbstractBase</span> <span class="kd">implements</span> <span class="n">IApplication1</span><span class="p">,</span> <span class="n">IObserver</span><span class="p">{</span>
<span class="kd">protected</span> <span class="n">ProtocolType</span> <span class="n">protocolToWEnv</span><span class="p">;</span>
    <span class="kd">public</span> <span class="nf">Application1AbstractBase</span><span class="p">(</span><span class="n">String</span> <span class="n">name</span><span class="p">,</span> <span class="n">String</span> <span class="n">hostIp</span><span class="p">,</span>  <span class="kt">boolean</span> <span class="n">fastPc</span><span class="p">){</span>
        <span class="k">this</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">hostIp</span><span class="p">,</span>  <span class="n">fastPc</span><span class="p">,</span> <span class="k">new</span> <span class="n">Vector</span><span class="o">&lt;</span><span class="n">IObserver</span><span class="o">&gt;</span><span class="p">()</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="nf">Application1AbstractBase</span><span class="p">(</span><span class="n">String</span> <span class="n">name</span><span class="p">,</span> <span class="n">String</span> <span class="n">hostIp</span><span class="p">,</span>
            <span class="n">ProtocolType</span> <span class="kt">boolean</span> <span class="n">fastPc</span><span class="p">,</span> <span class="n">Vector</span><span class="o">&lt;</span><span class="n">IObserver</span><span class="o">&gt;</span> <span class="n">externalObs</span><span class="p">){</span>
        <span class="k">this</span><span class="p">.</span><span class="na">name</span>      <span class="o">=</span> <span class="n">name</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="na">fastPc</span>    <span class="o">=</span> <span class="n">fastPc</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addAnObserverOnAppl</span><span class="p">(</span><span class="n">IObserver</span> <span class="n">o</span><span class="p">){</span> <span class="n">obs</span><span class="p">.</span><span class="na">add</span><span class="p">(</span> <span class="n">o</span> <span class="p">);</span> <span class="p">}</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">updateObservers</span><span class="p">(</span><span class="n">String</span> <span class="n">msg</span><span class="p">){</span> <span class="n">obs</span><span class="p">.</span><span class="na">forEach</span><span class="p">(</span> <span class="n">o</span> <span class="o">-&gt;</span> <span class="n">o</span><span class="p">.</span><span class="na">update</span><span class="p">(</span><span class="n">msg</span><span class="p">));</span> <span class="p">}</span>

    <span class="kd">protected</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">waitResume</span><span class="p">(){</span> <span class="p">...</span> <span class="p">}</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span>  <span class="kt">void</span> <span class="nf">stop</span><span class="p">(){</span> <span class="n">stopped</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span> <span class="p">}</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">start</span><span class="p">(</span>   <span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span> <span class="o">!</span> <span class="n">started</span> <span class="p">){</span> <span class="n">doJob</span><span class="p">();</span>
    <span class="p">}</span><span class="k">else</span> <span class="n">CommUtils</span><span class="p">.</span><span class="na">outyellow</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s">&quot; | already started&quot;</span><span class="p">);</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="p">(</span><span class="n">String</span> <span class="n">s</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">s</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;move(w)&quot;</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">stopped</span> <span class="p">)</span> <span class="n">waitResume</span><span class="p">();</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="c1">//updateObservers(s);</span>
    <span class="p">}</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="p">(</span><span class="n">Observable</span> <span class="n">o</span><span class="p">,</span> <span class="n">Object</span> <span class="n">arg</span><span class="p">)</span> <span class="p">{</span><span class="n">update</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="o">+</span><span class="n">arg</span><span class="p">);}</span>

    <span class="kd">protected</span> <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">doJob</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">Exception</span><span class="p">;</span>
 <span class="p">}</span>
</pre></div>
</div>
<p>Il parametro <cite>fastPc</cite> passato al costrutture permette di fossare parametri temporali diversi per computer ‘veloci’ o ‘lenti’.</p>
</section>
<section id="unibo-appl1-interaction-application1coreconn">
<h3>unibo.appl1.interaction.Application1CoreConn<a class="headerlink" href="#unibo-appl1-interaction-application1coreconn" title="Permalink to this headline">¶</a></h3>
<p>Per aumentare la flessibilità, la nuova versione dell’applicazione
(che generalizza <a class="reference internal" href="Applicazione1-HTTP-Core.html#codice-di-unibo-appl1-http-application1httpcore"><span class="std std-ref">Application1Core</span></a> )
riceve nel costruttore
il parametro <span class="blue">hostIp</span> che denota l’indirizzo del nodo che esegue il
<a class="reference internal" href="VirtualRobot23.html#virtualrobot23"><span class="std std-ref">VirtualRobot23</span></a> ed il parametro <span class="blue">protocolToWEnv</span> che denota il protocollo da
usare per le intera&lt;zioni con WEnv.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Application1CoreConn</span> <span class="kd">extends</span> <span class="n">Application1AbstractBase</span> <span class="p">{</span>
<span class="kd">protected</span> <span class="kd">final</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="n">fastPc</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="kd">protected</span> <span class="n">ProtocolType</span> <span class="n">protocolToWEnv</span><span class="p">;</span>

 <span class="kd">public</span> <span class="nf">Application1CoreConn</span><span class="p">(</span><span class="n">String</span> <span class="n">name</span><span class="p">,</span> <span class="n">String</span> <span class="n">hostIp</span><span class="p">,</span> <span class="n">ProtocolType</span> <span class="n">protocolToWEnv</span><span class="p">){</span>
     <span class="kd">super</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">hostIp</span><span class="p">,</span><span class="n">protocolToWEnv</span><span class="p">,</span><span class="n">fastPc</span><span class="p">);</span>
     <span class="k">try</span> <span class="p">{</span>
         <span class="k">this</span><span class="p">.</span><span class="na">protocolToWEnv</span> <span class="o">=</span> <span class="n">protocolToWEnv</span><span class="p">;</span>
         <span class="n">vr</span> <span class="o">=</span> <span class="n">VrobotHLSupportFactory</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">hostIp</span><span class="p">,</span><span class="n">protocolToWEnv</span><span class="p">);</span>
     <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{...}</span>
 <span class="p">}</span>
 <span class="nd">@Override</span>
 <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doJob</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>
     <span class="n">walkAtBoundary</span><span class="p">();</span>
     <span class="n">CommUtils</span><span class="p">.</span><span class="na">delay</span><span class="p">(</span><span class="mi">1500</span><span class="p">);</span> <span class="c1">////To see the asynch messages (if any)</span>
     <span class="n">CommUtils</span><span class="p">.</span><span class="na">outblue</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s">&quot; | doJob BYE &quot;</span>  <span class="p">);</span>
 <span class="p">}</span>
 <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span> <span class="n">String</span><span class="o">[]</span> <span class="n">args</span> <span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>
     <span class="n">Application1CoreConn</span> <span class="n">appl</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Application1CoreConn</span><span class="p">(</span><span class="s">&quot;Application1CoreConn&quot;</span><span class="p">,</span><span class="s">&quot;localhost&quot;</span><span class="p">,</span> <span class="n">ProtocolType</span><span class="p">.</span><span class="na">ws</span> <span class="p">);</span>
     <span class="c1">//L&#39;applicazione si blocca in attesa del comando start</span>
     <span class="c1">//appl.addObserver( new Appl1Observer() );</span>
     <span class="c1">//I comandi vengono inviati da altri programmi (remoti)</span>
     <span class="n">appl</span><span class="p">.</span><span class="na">start</span><span class="p">();</span>
 <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="interazioni-console-appl1">
<h3>Interazioni Console-Appl1<a class="headerlink" href="#interazioni-console-appl1" title="Permalink to this headline">¶</a></h3>
<p>Affrontiamo ora le interazioni <span class="remark">CmdConsole –&gt; Appl1</span>, osservando che:</p>
<ol class="arabic simple">
<li><p><em>Appl1</em> deve ‘evolvere’ in modo da poter ricevere messaggi: normalmente questo obiettivo implica la introduzione
di un <span class="blue">server</span>.</p></li>
<li><p><em>CmdConsole</em> deve operare come un <span class="blue">client</span> nei confronti del server relativo ad <em>Appl1</em>.</p></li>
</ol>
<a class="reference internal image-reference" href="_images/ArchCmdConsoleAppl.png"><img alt="_images/ArchCmdConsoleAppl.png" src="_images/ArchCmdConsoleAppl.png" style="width: 80%;" /></a>
<p>Il progetto <a class="reference internal" href="unibo.basicomm23.html#unibo-basicomm23"><span class="std std-ref">unibo.basicomm23</span></a>  fornisce supporti per entrambe queste esigenze, attraverso due ‘enti abilitatori’:</p>
<ol class="arabic simple">
<li><p><a class="reference internal" href="unibo.basicomm23.html#unibo-basicomm23-enablers-enablerasserver"><span class="std std-ref">EnablerAsServer</span></a></p></li>
<li><p><a class="reference internal" href="unibo.basicomm23.html#unibo-basicomm23-enablers-callerasclient"><span class="std std-ref">CallerAsClient</span></a></p></li>
</ol>
<a class="reference internal image-reference" href="_images/CallerAsClient.png"><img alt="_images/CallerAsClient.png" src="_images/CallerAsClient.png" style="width: 50%;" /></a>
</section>
</section>
<section id="cmdconsole">
<h2>CmdConsole<a class="headerlink" href="#cmdconsole" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li><p><em>CmdConsole</em> deve diventare un ente attivo che interagisce con un utente umano e che invia comandi ad <code class="docutils literal notranslate"><span class="pre">Appl1</span></code>
usando un protocollo <code class="docutils literal notranslate"><span class="pre">P</span></code> tra quelli definiti in <a class="reference internal" href="Applicazione1-HTTP-Core.html#unibo-basicomm23-msg-protocoltype"><span class="std std-ref">ProtocolType</span></a>.</p></li>
</ol>
<p>Dopo colloquio con il committente, si è convenuto di usare <code class="docutils literal notranslate"><span class="pre">TCP</span></code>.</p>
<p>Piano di lavoro:</p>
<ol class="arabic simple">
<li><p>In primo luogo definiamo un simulatore simile a <a class="reference internal" href="Applicazione1-HTTP-Core.html#unibo-console-cmdconsolesimulator"><span class="std std-ref">unibo.console.CmdConsoleSimulator</span></a> che denominiamo
<span class="blue">CmdConsoleRemote</span>, per evidenziare che non opera più con interazioni locali a procedure call</p></li>
<li><p>Successivamente, definiamo una <a class="reference internal" href="#unibo-console-gui-startstopguiremote"><span class="std std-ref">StartStopGui</span></a> in Java, che offre ad un utente umano un insieme di pulsanti
per inviare ad Appl1 i comandi  <code class="docutils literal notranslate"><span class="pre">start/stop/resume</span></code>.</p></li>
</ol>
<section id="unibo-appl1-interaction-cmdconsoleremote">
<h3>unibo.appl1.interaction.CmdConsoleRemote<a class="headerlink" href="#unibo-appl1-interaction-cmdconsoleremote" title="Permalink to this headline">¶</a></h3>
<p><em>CmdConsoleRemote</em> estende l’abilitatore <a class="reference internal" href="unibo.basicomm23.html#unibo-basicomm23-enablers-callerasclient"><span class="std std-ref">CallerAsClient</span></a>
che stabilsce una <span class="xref std std-ref">Interconnessione</span> con <a class="reference internal" href="VirtualRobot23.html#virtualrobot23"><span class="std std-ref">VirtualRobot23</span></a>
usando il <code class="docutils literal notranslate"><span class="pre">protocol</span></code> dato.
L’uso di <a class="reference internal" href="unibo.basicomm23.html#unibo-basicomm23-utils-commutils"><span class="std std-ref">CommUtils</span></a> e di <a class="reference internal" href="#unibo-appl1-common-vrobotmsgs"><span class="std std-ref">VrobotMsgs</span></a>
rende il codice più snello e leggibile.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CmdConsoleRemote</span> <span class="kd">extends</span> <span class="n">CallerAsClient</span> <span class="p">{</span>
 <span class="kd">public</span> <span class="nf">CmdConsoleRemote</span><span class="p">(</span>
         <span class="n">String</span> <span class="n">name</span><span class="p">,</span> <span class="n">String</span> <span class="n">host</span><span class="p">,</span> <span class="n">String</span> <span class="n">entry</span><span class="p">,</span> <span class="n">ProtocolType</span> <span class="n">protocol</span><span class="p">)</span> <span class="p">{</span>
     <span class="kd">super</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">entry</span><span class="p">,</span> <span class="n">protocol</span><span class="p">);</span> <span class="c1">//Realizza connessione</span>
     <span class="n">activateSimulation</span><span class="p">();</span>
 <span class="p">}</span>

 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">activateSimulation</span><span class="p">(</span>   <span class="p">)</span> <span class="p">{</span>
      <span class="p">...</span>
   <span class="n">IApplMessage</span> <span class="n">startMsg</span> <span class="o">=</span>
      <span class="n">CommUtils</span><span class="p">.</span><span class="na">buildDispatch</span><span class="p">(</span><span class="n">name</span><span class="p">.</span><span class="na">toLowerCase</span><span class="p">(),</span><span class="s">&quot;cmd&quot;</span><span class="p">,</span><span class="s">&quot;start&quot;</span><span class="p">,</span><span class="s">&quot;appl1&quot;</span><span class="p">);</span>
      <span class="n">CommUtils</span><span class="p">.</span><span class="na">forwardOnInterconn</span><span class="p">(</span><span class="n">getConn</span><span class="p">(),</span><span class="n">startMsg</span><span class="p">.</span><span class="na">toString</span><span class="p">());</span>
      <span class="p">...</span>
   <span class="n">IApplMessage</span> <span class="n">stopMsg</span> <span class="o">=</span>
      <span class="n">CommUtils</span><span class="p">.</span><span class="na">buildDispatch</span><span class="p">(</span><span class="n">name</span><span class="p">.</span><span class="na">toLowerCase</span><span class="p">(),</span><span class="s">&quot;cmd&quot;</span><span class="p">,</span><span class="s">&quot;&#39;&quot;</span><span class="o">+</span><span class="n">VrobotMsgs</span><span class="p">.</span><span class="na">stoprobot</span><span class="o">+</span><span class="s">&quot;&#39;&quot;</span><span class="p">,</span><span class="s">&quot;appl1&quot;</span><span class="p">);</span>
      <span class="n">CommUtils</span><span class="p">.</span><span class="na">forwardOnInterconn</span><span class="p">(</span> <span class="n">getConn</span><span class="p">(),</span> <span class="n">startMsg</span><span class="p">.</span><span class="na">toString</span><span class="p">());</span>
      <span class="p">...</span>
 <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="unibo-console-gui-startstopguiremote">
<h3>unibo.console.gui.StartStopGuiRemote<a class="headerlink" href="#unibo-console-gui-startstopguiremote" title="Permalink to this headline">¶</a></h3>
<p>La classe <em>StartStopGui</em> realizza una semplice GUI Java, che si presenta all’utente come segue:</p>
<a class="reference internal image-reference" href="_images/StartStopGui.png"><img alt="_images/StartStopGui.png" src="_images/StartStopGui.png" style="width: 20%;" /></a>
<p>La classe è defiita come un <code class="docutils literal notranslate"><span class="pre">java.util.Observer</span></code> il cui metodo <code class="docutils literal notranslate"><span class="pre">update</span></code> viene invocato
dal <code class="docutils literal notranslate"><span class="pre">java.awt.event.ActionListener</span></code> realizzato da <code class="docutils literal notranslate"><span class="pre">ButtonAsGui</span></code> che
estende <code class="docutils literal notranslate"><span class="pre">java.util.Observable</span></code> e che crea i pulsanti su un <code class="docutils literal notranslate"><span class="pre">java.awt.Frame</span></code>:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">StartStopGuiRemote</span> <span class="kd">implements</span>  <span class="n">Observer</span><span class="p">{</span>
<span class="kd">private</span> <span class="n">String</span><span class="o">[]</span> <span class="n">buttonLabels</span>  <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">[]</span> <span class="p">{</span><span class="s">&quot;start&quot;</span><span class="p">,</span> <span class="s">&quot;stop&quot;</span><span class="p">,</span> <span class="s">&quot;resume&quot;</span><span class="p">,</span> <span class="s">&quot;exit&quot;</span> <span class="p">};</span>
<span class="kd">private</span> <span class="n">String</span> <span class="n">destName</span><span class="p">;</span>
<span class="kd">private</span> <span class="n">Interaction2021</span> <span class="n">conn</span><span class="p">;</span>

   <span class="kd">public</span> <span class="nf">StartStopGuiRemote</span><span class="p">(</span><span class="n">String</span> <span class="n">destName</span><span class="p">,</span> <span class="n">ProtocolType</span> <span class="n">protocol</span><span class="p">,</span> <span class="n">String</span> <span class="n">port</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">ButtonAsGui</span> <span class="n">concreteButton</span> <span class="o">=</span> <span class="n">ButtonAsGui</span><span class="p">.</span><span class="na">createButtons</span><span class="p">(</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">buttonLabels</span> <span class="p">);</span>
      <span class="n">concreteButton</span><span class="p">.</span><span class="na">addObserver</span><span class="p">(</span> <span class="k">this</span> <span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="na">destName</span> <span class="o">=</span> <span class="n">destName</span><span class="p">;</span>
      <span class="p">...</span>
      <span class="n">conn</span> <span class="o">=</span> <span class="n">ConnectionFactory</span><span class="p">.</span><span class="na">createClientSupport</span><span class="p">(</span><span class="n">protocol</span><span class="p">,</span><span class="s">&quot;localhost&quot;</span><span class="p">,</span> <span class="n">port</span><span class="p">);</span>
   <span class="p">}</span>
   <span class="nd">@Override</span> <span class="c1">//For Observer</span>
   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="p">(</span> <span class="n">Observable</span> <span class="n">o</span> <span class="p">,</span> <span class="n">Object</span> <span class="n">arg</span> <span class="p">)</span> <span class="p">{</span>
      <span class="n">String</span> <span class="n">move</span> <span class="o">=</span> <span class="n">arg</span><span class="p">.</span><span class="na">toString</span><span class="p">();</span>
      <span class="p">...</span>
      <span class="n">IApplMessage</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">CommUtils</span><span class="p">.</span><span class="na">buildDispatch</span><span class="p">(</span><span class="s">&quot;gui&quot;</span><span class="p">,</span> <span class="n">move</span><span class="p">,</span> <span class="n">move</span><span class="p">,</span> <span class="n">destName</span><span class="p">);</span>
      <span class="n">conn</span><span class="p">.</span><span class="na">forward</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="na">toString</span><span class="p">());</span>
   <span class="p">}</span>
   <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span> <span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">new</span> <span class="n">StartStopGui</span><span class="p">(</span> <span class="s">&quot;Appl1GuiRemote&quot;</span><span class="p">,</span>
         <span class="n">Application1SystemBuilder</span><span class="p">.</span><span class="na">protocol</span><span class="p">,</span> <span class="n">Application1SystemBuilder</span><span class="p">.</span><span class="na">port</span> <span class="p">);</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="unibo-appl1-interaction-application1systembuilder">
<h3>unibo.appl1.interaction.Application1SystemBuilder<a class="headerlink" href="#unibo-appl1-interaction-application1systembuilder" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="#unibo-appl1-interaction-application1systembuilder"><span class="std std-ref">Application1SystemBuilder</span></a> è il componente che
definisce il protocollo  e la porta del server e  crea l’architettura del sistema applicativo mostrata nella figura che segue:</p>
<table class="colwidths-given docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><a class="reference internal image-reference" href="_images/Appl1Enabler.png"><img alt="_images/Appl1Enabler.png" src="_images/Appl1Enabler.png" style="width: 100%;" /></a>
</td>
<td><ul class="simple">
<li><p>I componenti con freccia rappresentano enti attivi</p></li>
<li><p><a class="reference internal" href="#unibo-appl1-interaction-appl1msghandler"><span class="std std-ref">Appl1MsgHandler</span></a> gestisce i messaggi ricevuti
da  <a class="reference internal" href="unibo.basicomm23.html#unibo-basicomm23-enablers-enablerasserver"><span class="std std-ref">EnablerAsServer</span></a> invocando i metodi di
<a class="reference internal" href="#unibo-appl1-interaction-application1coreconn"><span class="std std-ref">Application1CoreConn</span></a>.</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">unibo.appl1.interaction</span><span class="p">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Application1SystemBuilder</span> <span class="p">{</span>
 <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">ProtocolType</span> <span class="n">protocol</span> <span class="o">=</span> <span class="n">ProtocolType</span><span class="p">.</span><span class="na">tcp</span><span class="p">;</span>
 <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">port</span>           <span class="o">=</span> <span class="s">&quot;8030&quot;</span><span class="p">;</span>
 <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">portNum</span>            <span class="o">=</span> <span class="mi">8030</span><span class="p">;</span>

 <span class="kd">private</span> <span class="n">IApplication1MsgHandler</span> <span class="n">applMsgHandler</span><span class="p">;</span>
 <span class="kd">private</span> <span class="n">EnablerAsServer</span> <span class="n">server</span><span class="p">;</span>

 <span class="kd">public</span> <span class="nf">Application1SystemBuilder</span><span class="p">(</span>
         <span class="n">String</span> <span class="n">name</span><span class="p">,</span> <span class="n">IApplication1MsgHandler</span>  <span class="n">applMsgHandler</span> <span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span><span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="na">name</span>            <span class="o">=</span> <span class="n">name</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="na">applMsgHandler</span>  <span class="o">=</span> <span class="n">applMsgHandler</span><span class="p">;</span>
      <span class="n">server</span>               <span class="o">=</span> <span class="k">new</span> <span class="n">EnablerAsServer</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">portNum</span><span class="p">,</span> <span class="n">protocol</span><span class="p">,</span><span class="n">applMsgHandler</span><span class="p">);</span>
      <span class="n">server</span><span class="p">.</span><span class="na">start</span><span class="p">();</span>
 <span class="p">}</span>

 <span class="kd">public</span> <span class="n">IApplication1MsgHandler</span> <span class="nf">getHandler</span><span class="p">(){</span> <span class="k">return</span>  <span class="n">applMsgHandler</span><span class="p">;</span> <span class="p">}</span>
 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">terminate</span><span class="p">(){</span> <span class="n">server</span><span class="p">.</span><span class="na">stop</span><span class="p">();</span> <span class="p">}</span>

 <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span><span class="p">{</span>
      <span class="n">Application1SystemBuilder</span> <span class="n">appl</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Application1SystemBuilder</span><span class="p">(</span>
               <span class="s">&quot;appl1Server&quot;</span><span class="p">,</span><span class="k">new</span> <span class="n">Appl1MsgHandler</span><span class="p">(</span><span class="s">&quot;appl1MsgHandler&quot;</span><span class="p">)</span> <span class="p">);</span>
 <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="appl1-il-server">
<h2>Appl1: il server<a class="headerlink" href="#appl1-il-server" title="Permalink to this headline">¶</a></h2>
<p>Il gestore di messaggi <a class="reference internal" href="#unibo-appl1-interaction-appl1msghandler"><span class="std std-ref">Appl1MsgHandler</span></a> <span class="blue">crea</span>
(durante la gestione del messaggio <code class="docutils literal notranslate"><span class="pre">start</span></code>) il POJO
<a class="reference internal" href="#unibo-appl1-interaction-application1coreconn"><span class="std std-ref">Application1CoreConn</span></a> che definisce l’applicazione
e ne invoca poi i metodi relativi ai messaggi <code class="docutils literal notranslate"><span class="pre">stop/resume</span></code> ricevuti.</p>
<p>Il gestore applicativo dei messaggi deve realizzare l’interfaccia
<a class="reference internal" href="unibo.basicomm23.html#unibo-basicomm23-interfaces-iapplmsghandler"><span class="std std-ref">IApplMsgHandler</span></a> e deve funzionare come oggetto
osservabile ai fini di testing, logging, etc. Il suo contratto è</p>
<section id="unibo-appl1-interaction-iapplication1msghandler">
<h3>unibo.appl1.interaction.IApplication1MsgHandler<a class="headerlink" href="#unibo-appl1-interaction-iapplication1msghandler" title="Permalink to this headline">¶</a></h3>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">IApplication1MsgHandler</span> <span class="kd">extends</span> <span class="n">IApplMsgHandler</span> <span class="p">{</span>
   <span class="kd">public</span> <span class="n">Appl1Observer</span> <span class="nf">getApplObserver</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In questa fase riusiamo oggetti observer di classe <a class="reference internal" href="Applicazione1-HTTP-Core.html#unibo-appl1-common-appl1observer"><span class="std std-ref">unibo.appl1.common.Appl1Observer</span></a>.</p>
</section>
<section id="unibo-appl1-interaction-appl1msghandler">
<h3>unibo.appl1.interaction.Appl1MsgHandler<a class="headerlink" href="#unibo-appl1-interaction-appl1msghandler" title="Permalink to this headline">¶</a></h3>
<p>Il metodo <code class="docutils literal notranslate"><span class="pre">walkAtBoundary</span></code> (che rappresenta la fase proattiva dell’applicazione) viene invocato all’interno
di un nuovo Thread, per permettere la gestione di un messaggio di <code class="docutils literal notranslate"><span class="pre">stop</span></code>.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Appl1MsgHandler</span> <span class="kd">extends</span> <span class="n">ApplMsgHandler</span> <span class="kd">implements</span> <span class="n">IApplication1MsgHandler</span><span class="p">{</span>
 <span class="kd">private</span> <span class="n">Application1CoreConn</span> <span class="n">appl</span><span class="p">;</span>
 <span class="kd">private</span> <span class="n">Appl1Observer</span> <span class="n">obs</span>  <span class="o">=</span> <span class="k">new</span> <span class="n">Appl1Observer</span><span class="p">();</span>

 <span class="kd">public</span> <span class="nf">Appl1MsgHandler</span><span class="p">(</span><span class="n">String</span> <span class="n">name</span> <span class="p">)</span> <span class="p">{</span>
     <span class="kd">super</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
 <span class="p">}</span>

 <span class="nd">@Override</span> <span class="c1">//per ApplMsgHandler IApplication1MsgHandler</span>
 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">elaborate</span><span class="p">(</span><span class="n">IApplMessage</span> <span class="n">msg</span><span class="p">,</span> <span class="n">Interaction2021</span> <span class="n">conn</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span> <span class="n">msg</span><span class="p">.</span><span class="na">msgContent</span><span class="p">().</span><span class="na">contains</span><span class="p">(</span><span class="s">&quot;create&quot;</span><span class="p">)){</span>
     <span class="c1">//MESSAGGIO DI CREAZIONE DELLA APPLICAZIONE</span>
         <span class="n">createAppl</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
     <span class="p">}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span> <span class="n">msg</span><span class="p">.</span><span class="na">msgContent</span><span class="p">().</span><span class="na">contains</span><span class="p">(</span><span class="s">&quot;start&quot;</span><span class="p">)){</span>
      <span class="c1">//MESSAGGIO DI ATTIVAZIONE DELLA APPLICAZIONE</span>
         <span class="k">if</span><span class="p">(</span> <span class="n">appl</span> <span class="o">==</span> <span class="kc">null</span> <span class="p">)</span> <span class="n">createAppl</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
             <span class="k">new</span> <span class="n">Thread</span><span class="p">(){</span>
                 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="p">(){</span>
                     <span class="k">try</span> <span class="p">{</span>
                         <span class="n">appl</span><span class="p">.</span><span class="na">walkAtBoundary</span><span class="p">();</span>
                     <span class="p">}</span><span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{...</span> <span class="p">}</span>
                 <span class="p">}</span>
             <span class="p">}.</span><span class="na">start</span><span class="p">();</span>

     <span class="p">}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span> <span class="n">msg</span><span class="p">.</span><span class="na">msgContent</span><span class="p">().</span><span class="na">contains</span><span class="p">(</span><span class="s">&quot;stop&quot;</span><span class="p">)){</span>
         <span class="c1">//MESSAGGIO DI STOP</span>
         <span class="k">if</span><span class="p">(</span> <span class="n">appl</span> <span class="o">!=</span><span class="kc">null</span> <span class="p">)</span> <span class="n">appl</span><span class="p">.</span><span class="na">stop</span><span class="p">(</span>  <span class="p">);</span>
     <span class="p">}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span> <span class="n">msg</span><span class="p">.</span><span class="na">msgContent</span><span class="p">().</span><span class="na">contains</span><span class="p">(</span><span class="s">&quot;resume&quot;</span><span class="p">)){</span>
         <span class="c1">//MESSAGGIO DI RESUME</span>
         <span class="k">if</span><span class="p">(</span> <span class="n">appl</span> <span class="o">!=</span><span class="kc">null</span> <span class="p">)</span> <span class="n">appl</span><span class="p">.</span><span class="na">resume</span><span class="p">(</span>  <span class="p">);</span>
     <span class="p">}</span>
 <span class="p">}</span>

 <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">createAppl</span><span class="p">(</span><span class="n">IApplMessage</span> <span class="n">msg</span><span class="p">){</span>
     <span class="n">String</span> <span class="n">hostIp</span><span class="o">=</span> <span class="s">&quot;localhost&quot;</span><span class="p">;</span>
     <span class="n">appl</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Application1CoreConn</span><span class="p">(</span><span class="n">hostIp</span><span class="p">);</span>
     <span class="n">obs</span><span class="p">.</span><span class="na">init</span><span class="p">();</span>
     <span class="n">appl</span><span class="p">.</span><span class="na">addObserver</span><span class="p">(</span> <span class="n">obs</span> <span class="p">);</span>
 <span class="p">}</span>

 <span class="nd">@Override</span> <span class="c1">//per IApplication1MsgHandler</span>
 <span class="kd">public</span> <span class="n">Appl1Observer</span> <span class="nf">getApplObserver</span><span class="p">(){</span>
     <span class="k">return</span> <span class="n">obs</span><span class="p">;</span>
 <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Il metodo <code class="docutils literal notranslate"><span class="pre">getApplObserver</span></code> restituisce l’osservatore
(di classe <a class="reference internal" href="Applicazione1-HTTP-Core.html#unibo-appl1-common-appl1observer"><span class="std std-ref">unibo.appl1.common.Appl1Observer</span></a>)
posto sull’applicazione che abbiamo in precedena introdotto ai fini di testing, logging, etc.</p>
</section>
<section id="appl1-architettura-finale">
<h3>Appl1: architettura finale<a class="headerlink" href="#appl1-architettura-finale" title="Permalink to this headline">¶</a></h3>
<a class="reference internal image-reference" href="_images/Appl1FinalArchitecture.png"><img alt="_images/Appl1FinalArchitecture.png" src="_images/Appl1FinalArchitecture.png" style="width: 80%;" /></a>
</section>
</section>
<section id="testing-del-sistema-distribuito">
<h2>Testing del sistema distribuito<a class="headerlink" href="#testing-del-sistema-distribuito" title="Permalink to this headline">¶</a></h2>
<p>La struttura del codice di testing è simile a quanto introdotto in
<a class="reference internal" href="Applicazione1-HTTP-Core.html#unibo-appl1-http-testcommonappl1httplocal"><span class="std std-ref">unibo.appl1.http.TestCommonAppl1HTTPLocal</span></a>.</p>
<p>In questo caso:</p>
<ul class="simple">
<li><p>nella fase iniziale (<code class="docutils literal notranslate"><span class="pre">&#64;Before</span></code>) che precede ogni metodo di testing, attiviamo
<a class="reference internal" href="#unibo-appl1-interaction-application1systembuilder"><span class="std std-ref">Application1SystemBuilder</span></a>;</p></li>
<li><p>nella fase terminale  (<code class="docutils literal notranslate"><span class="pre">&#64;After</span></code>) terminiamo il builder, che a sua volta termina il server;</p></li>
<li><p>le procedure di testing inviano messaggi (<code class="docutils literal notranslate"><span class="pre">dispatch</span></code>) via TCP alla porta di ingresso di
<a class="reference internal" href="unibo.basicomm23.html#unibo-basicomm23-enablers-enablerasserver"><span class="std std-ref">EnablerAsServer</span></a>.</p></li>
</ul>
<section id="unibo-appl1-interaction-testaapplication1system">
<h3>unibo.appl1.interaction.TestAApplication1System<a class="headerlink" href="#unibo-appl1-interaction-testaapplication1system" title="Permalink to this headline">¶</a></h3>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestAApplication1System</span> <span class="p">{</span>
<span class="kd">private</span> <span class="n">IApplication1MsgHandler</span> <span class="n">applMsgHandler</span><span class="p">;</span>
<span class="kd">private</span> <span class="n">Application1SystemBuilder</span> <span class="n">builder</span><span class="p">;</span>

 <span class="nd">@Before</span>
 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">startTheServer</span><span class="p">(){</span>
     <span class="k">try</span> <span class="p">{</span>
         <span class="n">applMsgHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Appl1MsgHandler</span><span class="p">(</span><span class="s">&quot;appl1MsgHandler&quot;</span><span class="p">);</span>
         <span class="n">builder</span>        <span class="o">=</span> <span class="k">new</span> <span class="n">Application1SystemBuilder</span><span class="p">(</span><span class="s">&quot;appl1Server&quot;</span><span class="p">,</span><span class="n">applMsgHandler</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
         <span class="n">fail</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span>
     <span class="p">}</span>
 <span class="p">}</span>

 <span class="nd">@After</span>
 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">terminateTheServer</span><span class="p">()</span> <span class="p">{</span>
     <span class="n">builder</span><span class="p">.</span><span class="na">terminate</span><span class="p">();</span>
     <span class="n">CommUtils</span><span class="p">.</span><span class="na">delay</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span>
 <span class="p">}</span>

 <span class="nd">@Test</span>
 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testStartNoStop</span><span class="p">(){</span>
     <span class="n">CommUtils</span><span class="p">.</span><span class="na">outmagenta</span><span class="p">(</span><span class="s">&quot;testStartNoStop&quot;</span><span class="p">);</span>
     <span class="c1">//startTheApplication();</span>
     <span class="n">CallerAsClient</span> <span class="n">caller</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CallerAsClient</span><span class="p">(</span> <span class="s">&quot;testerCaller&quot;</span><span class="p">,</span> <span class="s">&quot;localhost&quot;</span><span class="p">,</span>
              <span class="n">Application1SystemBuilder</span><span class="p">.</span><span class="na">port</span><span class="p">,</span> <span class="n">Application1SystemBuilder</span><span class="p">.</span><span class="na">protocol</span><span class="p">);</span>
     <span class="n">IApplMessage</span> <span class="n">startMsg</span> <span class="o">=</span> <span class="n">CommUtils</span><span class="p">.</span><span class="na">buildDispatch</span><span class="p">(</span><span class="s">&quot;tester&quot;</span><span class="p">,</span> <span class="s">&quot;cmd&quot;</span><span class="p">,</span> <span class="s">&quot;start&quot;</span><span class="p">,</span> <span class="s">&quot;appl1&quot;</span><span class="p">);</span>
     <span class="n">CommUtils</span><span class="p">.</span><span class="na">forwardOnInterconn</span><span class="p">(</span><span class="n">caller</span><span class="p">.</span><span class="na">getConn</span><span class="p">(),</span><span class="n">startMsg</span><span class="p">.</span><span class="na">toString</span><span class="p">());</span>
     <span class="n">applMsgHandler</span><span class="p">.</span><span class="na">getApplObserver</span><span class="p">().</span><span class="na">waitApplTerminated</span><span class="p">();</span>
     <span class="k">assert</span><span class="p">(</span> <span class="kc">true</span> <span class="p">);</span>
 <span class="p">}</span>

 <span class="nd">@Test</span>
 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testStop</span><span class="p">(){</span>
     <span class="k">try</span> <span class="p">{</span>
         <span class="n">CallerAsClient</span> <span class="n">caller</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CallerAsClient</span><span class="p">(</span> <span class="s">&quot;testerCaller&quot;</span><span class="p">,</span> <span class="s">&quot;localhost&quot;</span><span class="p">,</span>
                 <span class="n">Application1SystemBuilder</span><span class="p">.</span><span class="na">port</span><span class="p">,</span> <span class="n">Application1SystemBuilder</span><span class="p">.</span><span class="na">protocol</span><span class="p">);</span>
         <span class="n">IApplMessage</span> <span class="n">startMsg</span> <span class="o">=</span> <span class="n">CommUtils</span><span class="p">.</span><span class="na">buildDispatch</span><span class="p">(</span><span class="s">&quot;tester&quot;</span><span class="p">,</span> <span class="s">&quot;cmd&quot;</span><span class="p">,</span> <span class="s">&quot;start&quot;</span><span class="p">,</span> <span class="s">&quot;appl1&quot;</span><span class="p">);</span>
         <span class="n">CommUtils</span><span class="p">.</span><span class="na">forwardOnInterconn</span><span class="p">(</span><span class="n">caller</span><span class="p">.</span><span class="na">getConn</span><span class="p">(),</span><span class="n">startMsg</span><span class="p">.</span><span class="na">toString</span><span class="p">());</span>
         <span class="n">CommUtils</span><span class="p">.</span><span class="na">delay</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span> <span class="c1">//Attendo un pò ...</span>
         <span class="n">IApplMessage</span> <span class="n">stopMsg</span> <span class="o">=</span> <span class="n">CommUtils</span><span class="p">.</span><span class="na">buildDispatch</span><span class="p">(</span>
               <span class="s">&quot;tester&quot;</span><span class="p">,</span> <span class="s">&quot;cmd&quot;</span><span class="p">,</span> <span class="s">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="n">VrobotMsgs</span><span class="p">.</span><span class="na">stoprobot</span> <span class="o">+</span> <span class="s">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s">&quot;appl1&quot;</span><span class="p">);</span>
         <span class="n">CommUtils</span><span class="p">.</span><span class="na">forwardOnInterconn</span><span class="p">(</span><span class="n">caller</span><span class="p">.</span><span class="na">getConn</span><span class="p">(),</span><span class="n">stopMsg</span><span class="p">.</span><span class="na">toString</span><span class="p">());</span>
         <span class="n">checkHistoryAfterStop</span><span class="p">();</span>
         <span class="n">CommUtils</span><span class="p">.</span><span class="na">delay</span><span class="p">(</span><span class="mi">1000</span> <span class="p">);</span><span class="c1">//Attendo un pò ...</span>
         <span class="n">continueToHome</span><span class="p">(</span> <span class="n">caller</span> <span class="p">);</span>
     <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
         <span class="n">fail</span><span class="p">(</span><span class="s">&quot;TestAppl1HTTPLocal | testStart &quot;</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span>
     <span class="p">}</span>
 <span class="p">}</span>

 <span class="kd">private</span> <span class="kt">void</span> <span class="nf">continueToHome</span><span class="p">(</span> <span class="n">CallerAsClient</span> <span class="n">caller</span> <span class="p">){</span>
     <span class="n">IApplMessage</span> <span class="n">resumeMsg</span> <span class="o">=</span> <span class="n">CommUtils</span><span class="p">.</span><span class="na">buildDispatch</span><span class="p">(</span>
         <span class="s">&quot;tester&quot;</span><span class="p">,</span> <span class="s">&quot;cmd&quot;</span><span class="p">,</span> <span class="s">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="n">VrobotMsgs</span><span class="p">.</span><span class="na">resumerobot</span> <span class="o">+</span> <span class="s">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s">&quot;appl1&quot;</span><span class="p">);</span>
     <span class="n">CommUtils</span><span class="p">.</span><span class="na">forwardOnInterconn</span><span class="p">(</span><span class="n">caller</span><span class="p">.</span><span class="na">getConn</span><span class="p">(),</span><span class="n">resumeMsg</span><span class="p">.</span><span class="na">toString</span><span class="p">());</span>
     <span class="n">applMsgHandler</span><span class="p">.</span><span class="na">getApplObserver</span><span class="p">().</span><span class="na">waitApplTerminated</span><span class="p">();</span>
 <span class="p">}</span>

 <span class="kd">private</span> <span class="kt">void</span> <span class="nf">checkHistoryAfterStop</span><span class="p">(){</span>
     <span class="n">CommUtils</span><span class="p">.</span><span class="na">delay</span><span class="p">(</span><span class="mi">1500</span><span class="p">);</span> <span class="c1">//Per elaborare ultime stringhe negli observers (Non bello)</span>
     <span class="n">Vector</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">h</span> <span class="o">=</span> <span class="n">applMsgHandler</span><span class="p">.</span><span class="na">getApplObserver</span><span class="p">().</span><span class="na">getHistory</span><span class="p">();</span>
     <span class="k">assert</span><span class="p">(</span> <span class="n">h</span><span class="p">.</span><span class="na">elementAt</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;robot-athomebegin&quot;</span><span class="p">));</span>
     <span class="k">assert</span><span class="p">(</span> <span class="n">h</span><span class="p">.</span><span class="na">elementAt</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;robot-moving&quot;</span><span class="p">));</span>
     <span class="k">if</span><span class="p">(</span> <span class="n">h</span><span class="p">.</span><span class="na">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="p">)</span> <span class="k">assert</span><span class="p">(</span> <span class="n">h</span><span class="p">.</span><span class="na">elementAt</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;robot-stable&quot;</span><span class="p">));</span>
     <span class="c1">//Dopo il secondo item ci possono essere altre coppie robot-moving/robot-stable</span>
     <span class="k">assert</span><span class="p">(</span> <span class="n">h</span><span class="p">.</span><span class="na">elementAt</span><span class="p">(</span><span class="n">h</span><span class="p">.</span><span class="na">size</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">).</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;robot-stopped&quot;</span><span class="p">));</span>
     <span class="k">assert</span><span class="p">(</span> <span class="kc">true</span> <span class="p">);</span>
 <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="appl1-modifica-ai-protocolli">
<h2>Appl1: Modifica ai protocolli<a class="headerlink" href="#appl1-modifica-ai-protocolli" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li><p>L’interazione tra <a class="reference internal" href="#unibo-appl1-interaction-application1coreconn"><span class="std std-ref">Application1CoreConn</span></a>
e <a class="reference internal" href="VirtualRobot23.html#virtualrobot23"><span class="std std-ref">VirtualRobot23</span></a> potrebbe essere basata su <code class="docutils literal notranslate"><span class="pre">WebSocket</span></code>, anzichè su <code class="docutils literal notranslate"><span class="pre">HTTP</span></code>.</p></li>
<li><p>L’interazioe tra <a class="reference internal" href="#unibo-console-gui-startstopguiremote"><span class="std std-ref">unibo.console.gui.StartStopGuiRemote</span></a> e
<a class="reference internal" href="unibo.basicomm23.html#unibo-basicomm23-enablers-enablerasserver"><span class="std std-ref">EnablerAsServer</span></a> porebbe essere basata su <code class="docutils literal notranslate"><span class="pre">UDP</span></code>,
anzichè su <code class="docutils literal notranslate"><span class="pre">TCP</span></code> o anche su un protocollo RESTful come <code class="docutils literal notranslate"><span class="pre">Coap</span></code>.</p></li>
</ol>
<p>Il secondo caso può essere ottenuto con la modifica a una linea di codice
in <a class="reference internal" href="#unibo-appl1-interaction-application1systembuilder"><span class="std std-ref">unibo.appl1.interaction.Application1SystemBuilder</span></a>; ad esempio:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Application1SystemBuilder</span> <span class="p">{</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">ProtocolType</span> <span class="n">protocol</span> <span class="o">=</span> <span class="n">ProtocolType</span><span class="p">.</span><span class="na">udp</span><span class="p">;</span>
</pre></div>
</div>
<p>Il primo caso, di sostituzione di <code class="docutils literal notranslate"><span class="pre">HTTP</span></code> con <code class="docutils literal notranslate"><span class="pre">WebSocket</span></code> al posto di <code class="docutils literal notranslate"><span class="pre">HTTP</span></code> potrebbe essere ottenuta nello stesso
modo, ma è opportuno esaminare questo caso più da vicino,
in quanto implica <a class="reference internal" href="VirtualRobot23.html#interazione-asincrona"><span class="std std-ref">Interazione asincrona</span></a> con <a class="reference internal" href="VirtualRobot23.html#virtualrobot23"><span class="std std-ref">VirtualRobot23</span></a>: lo faccaimo in <a class="reference internal" href="Applicazione1-WS.html#applicazione1-ws"><span class="std std-ref">Applicazione1-WS</span></a>.</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Applicazione1-HTTP-Distribuita</a><ul>
<li><a class="reference internal" href="#refactoring-di-vrobothlmoveshttpapache">Refactoring di VrobotHLMovesHTTPApache</a><ul>
<li><a class="reference internal" href="#unibo-supports-vrobothlmoveshttp">unibo.supports.VrobotHLMovesHTTP</a></li>
<li><a class="reference internal" href="#unibo-appl1-interaction-vrobothlmoves">unibo.appl1.interaction.VrobotHLMoves</a></li>
<li><a class="reference internal" href="#unibo-appl1-common-vrobotmsgs">unibo.appl1.common.VrobotMsgs</a></li>
</ul>
</li>
<li><a class="reference internal" href="#supporti-hl-robot">Supporti HL-robot</a><ul>
<li><a class="reference internal" href="#unibo-supports-vrobothlsupportfactory">unibo.supports.VrobotHLSupportFactory</a></li>
</ul>
</li>
<li><a class="reference internal" href="#il-contratto-applicativo">Il contratto applicativo</a><ul>
<li><a class="reference internal" href="#iapplication1">IApplication1</a></li>
<li><a class="reference internal" href="#unibo-appl1-common-application1abstractbase">unibo.appl1.common.Application1AbstractBase</a></li>
<li><a class="reference internal" href="#unibo-appl1-interaction-application1coreconn">unibo.appl1.interaction.Application1CoreConn</a></li>
<li><a class="reference internal" href="#interazioni-console-appl1">Interazioni Console-Appl1</a></li>
</ul>
</li>
<li><a class="reference internal" href="#cmdconsole">CmdConsole</a><ul>
<li><a class="reference internal" href="#unibo-appl1-interaction-cmdconsoleremote">unibo.appl1.interaction.CmdConsoleRemote</a></li>
<li><a class="reference internal" href="#unibo-console-gui-startstopguiremote">unibo.console.gui.StartStopGuiRemote</a></li>
<li><a class="reference internal" href="#unibo-appl1-interaction-application1systembuilder">unibo.appl1.interaction.Application1SystemBuilder</a></li>
</ul>
</li>
<li><a class="reference internal" href="#appl1-il-server">Appl1: il server</a><ul>
<li><a class="reference internal" href="#unibo-appl1-interaction-iapplication1msghandler">unibo.appl1.interaction.IApplication1MsgHandler</a></li>
<li><a class="reference internal" href="#unibo-appl1-interaction-appl1msghandler">unibo.appl1.interaction.Appl1MsgHandler</a></li>
<li><a class="reference internal" href="#appl1-architettura-finale">Appl1: architettura finale</a></li>
</ul>
</li>
<li><a class="reference internal" href="#testing-del-sistema-distribuito">Testing del sistema distribuito</a><ul>
<li><a class="reference internal" href="#unibo-appl1-interaction-testaapplication1system">unibo.appl1.interaction.TestAApplication1System</a></li>
</ul>
</li>
<li><a class="reference internal" href="#appl1-modifica-ai-protocolli">Appl1: Modifica ai protocolli</a></li>
</ul>
</li>
</ul>

  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/Applicazione1-HTTP-Distribuita.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="nav-item nav-item-0"><a href="index.html">iss23 1.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Applicazione1-HTTP-Distribuita</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2022, Antonio Natali.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.4.0.
    </div>
  </body>
</html>